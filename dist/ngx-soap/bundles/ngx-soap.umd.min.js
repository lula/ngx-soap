!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("sax"),require("lodash"),require("crypto-js/sha1"),require("crypto-js/enc-base64"),require("buffer"),require("url"),require("assert"),require("uuid/v4"),require("rxjs"),require("rxjs/operators"),require("@angular/common/http")):"function"==typeof define&&define.amd?define("ngx-soap",["exports","@angular/core","sax","lodash","crypto-js/sha1","crypto-js/enc-base64","buffer","url","assert","uuid/v4","rxjs","rxjs/operators","@angular/common/http"],t):t((e=e||self)["ngx-soap"]={},e.ng.core,e.sax,e.lodash,e.sha1,e.Base64,e.buffer,e.url,e.assert,e.uuid4,e.rxjs,e.rxjs.operators,e.ng.common.http)}(this,(function(e,t,s,n,i,o,r,a,p,c,u,l,h){"use strict";i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c;function d(e,t,s,n){return new(s||(s=Promise))((function(i,o){function r(e){try{p(n.next(e))}catch(e){o(e)}}function a(e){try{p(n.throw(e))}catch(e){o(e)}}function p(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}p((n=n.apply(e,t||[])).next())}))}function f(e,t){var s,n,i,o,r={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(s)throw new TypeError("Generator is already executing.");for(;r;)try{if(s=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,n=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(i=r.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){r=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){r.label=o[1];break}if(6===o[0]&&r.label<i[1]){r.label=i[1],i=o;break}if(i&&r.label<i[2]){r.label=i[2],r.ops.push(o);break}i[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(e){o=[6,e],n=0}finally{s=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function m(e){var t="function"==typeof Symbol&&Symbol.iterator,s=t&&e[t],n=0;if(s)return s.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}var y=function e(t){if(this.getNamespaceURI=function(e,t){switch(e){case"xml":return"http://www.w3.org/XML/1998/namespace";case"xmlns":return"http://www.w3.org/2000/xmlns/";default:var s=this.namespaces[e];return null!=s?s.uri:!t&&this.parent?this.parent.getNamespaceURI(e):null}},this.getNamespaceMapping=function(e){switch(e){case"xml":return{uri:"http://www.w3.org/XML/1998/namespace",prefix:"xml",declared:!0};case"xmlns":return{uri:"http://www.w3.org/2000/xmlns/",prefix:"xmlns",declared:!0};default:var t=this.namespaces[e];return null!=t?t:this.parent?this.parent.getNamespaceMapping(e):null}},this.getPrefix=function(e,t){switch(e){case"http://www.w3.org/XML/1998/namespace":return"xml";case"http://www.w3.org/2000/xmlns/":return"xmlns";default:for(var s in this.namespaces)if(this.namespaces[s].uri===e)return s;return!t&&this.parent?this.parent.getPrefix(e):null}},!(this instanceof e))return new e(t);this.parent=t,this.namespaces={}},v=function e(){if(this.addNamespace=function(e,t,s){return this.getNamespaceURI(e,s)!==t&&!!this.currentScope&&(this.currentScope.namespaces[e]={uri:t,prefix:e,declared:!1},!0)},this.pushContext=function(){var e=new y(this.currentScope);return this.scopes.push(e),this.currentScope=e,e},this.popContext=function(){var e=this.scopes.pop();return this.currentScope=e?e.parent:null,e},this.getNamespaceURI=function(e,t){return this.currentScope&&this.currentScope.getNamespaceURI(e,t)},this.getPrefix=function(e,t){return this.currentScope&&this.currentScope.getPrefix(e,t)},this.registerNamespace=function(e){var t=this.getPrefix(e);if(t)return t;for(;t="ns"+ ++this.prefixCount,this.getNamespaceURI(t););return this.addNamespace(t,e,!0),t},this.declareNamespace=function(e,t){if(this.currentScope){var s=this.currentScope.getNamespaceMapping(e);return!(s&&s.uri===t&&s.declared||(this.currentScope.namespaces[e]={uri:t,prefix:e,declared:!0},0))}return!1},!(this instanceof e))return new e;this.scopes=[],this.pushContext(),this.prefixCount=0},g=function(e,t){for(var s in e)if("__tns__"!==s&&e[s]===t)return s},x=g,b={string:1,boolean:1,decimal:1,float:1,double:1,anyType:1,byte:1,int:1,long:1,short:1,negativeInteger:1,nonNegativeInteger:1,positiveInteger:1,nonPositiveInteger:1,unsignedByte:1,unsignedInt:1,unsignedLong:1,unsignedShort:1,duration:0,dateTime:0,time:0,date:0,gYearMonth:0,gYear:0,gMonthDay:0,gDay:0,gMonth:0,hexBinary:0,base64Binary:0,anyURI:0,QName:0,NOTATION:0};function w(e){var t="string"==typeof e?e.indexOf(":"):-1;return t<0?{prefix:"__tns__",name:e}:{prefix:e.substring(0,t),name:e.substring(t+1)}}function S(e){return"string"==typeof e?"<![CDATA["===e.substr(0,9)&&"]]>"===e.substr(-3)?e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):e}var _=/^[\s\xA0]+/,$=/[\s\xA0]+$/;function T(e){return e.replace(_,"").replace($,"")}var C=function(e,t,s){var n=w(e);for(var i in this.nsName=e,this.prefix=n.prefix,this.name=n.name,this.children=[],this.xmlns={},this._initializeOptions(s),t){var o=/^xmlns:?(.*)$/.exec(i);o?this.xmlns[o[1]?o[1]:"__tns__"]=t[i]:"value"===i?this[this.valueKey]=t[i]:this["$"+i]=t[i]}void 0!==this.$targetNamespace&&(this.xmlns.__tns__=this.$targetNamespace)};C.prototype._initializeOptions=function(e){e?(this.valueKey=e.valueKey||"$value",this.xmlKey=e.xmlKey||"$xml",this.ignoredNamespaces=e.ignoredNamespaces||[]):(this.valueKey="$value",this.xmlKey="$xml",this.ignoredNamespaces=[])},C.prototype.deleteFixedAttrs=function(){this.children&&0===this.children.length&&delete this.children,this.xmlns&&0===Object.keys(this.xmlns).length&&delete this.xmlns,delete this.nsName,delete this.prefix,delete this.name},C.prototype.allowedChildren=[],C.prototype.startElement=function(e,t,s,n){if(this.allowedChildren){var i=this.allowedChildren[w(t).name];i?e.push(new i(t,s,n)):this.unexpected(t)}},C.prototype.endElement=function(e,t){if(this.nsName===t){if(e.length<2)return;var s=e[e.length-2];this!==e[0]&&(n.defaultsDeep(e[0].xmlns,this.xmlns),s.children.push(this),s.addChild(this)),e.pop()}},C.prototype.addChild=function(e){},C.prototype.unexpected=function(e){throw new Error("Found unexpected element ("+e+") inside "+this.nsName)},C.prototype.description=function(e){return this.$name||this.name},C.prototype.init=function(){},C.createSubClass=function(){var e=this,t=function(){e.apply(this,arguments),this.init()};return t.prototype.__proto__=e.prototype,t};var N=C.createSubClass(),j=C.createSubClass(),A=C.createSubClass(),O=C.createSubClass(),E=C.createSubClass(),P=C.createSubClass(),M=C.createSubClass(),L=C.createSubClass(),k=C.createSubClass(),H=C.createSubClass(),F=C.createSubClass(),I=C.createSubClass(),R=C.createSubClass(),B=C.createSubClass(),K=C.createSubClass(),X=C.createSubClass(),D=C.createSubClass(),U=C.createSubClass(),q=C.createSubClass(),z=C.createSubClass(),W=C.createSubClass(),J=C.createSubClass(),V=C.createSubClass(),Y=C.createSubClass(),G={types:[U,"schema documentation"],schema:[D,"element complexType simpleType include import"],element:[N,"annotation complexType"],any:[j,""],simpleType:[E,"restriction"],restriction:[P,"enumeration all choice sequence"],extension:[M,"all sequence choice"],choice:[L,"element sequence choice any"],enumeration:[k,""],complexType:[H,"annotation sequence all complexContent simpleContent choice"],complexContent:[F,"extension"],simpleContent:[I,"extension"],sequence:[R,"element sequence choice any"],all:[B,"element choice"],service:[V,"port documentation"],port:[J,"address documentation"],binding:[W,"_binding SecuritySpec operation documentation"],portType:[z,"operation documentation"],message:[K,"part documentation"],operation:[q,"documentation input output fault _operation"],input:[A,"body SecuritySpecRef documentation header"],output:[O,"body SecuritySpecRef documentation header"],fault:[C,"_fault documentation"],definitions:[Y,"types message portType binding service import documentation"],documentation:[X,""]};function Q(e){var t={};return(e=e.split(" ")).forEach((function(e){t[e.replace(/^_/,"")]=(G[e]||[C])[0]})),t}for(var Z in G){var ee=G[Z];ee[0].prototype.allowedChildren=Q(ee[1])}K.prototype.init=function(){this.element=null,this.parts=null},D.prototype.init=function(){this.complexTypes={},this.types={},this.elements={},this.includes=[]},U.prototype.init=function(){this.schemas={}},q.prototype.init=function(){this.input=null,this.output=null,this.inputSoap=null,this.outputSoap=null,this.style="",this.soapAction=""},z.prototype.init=function(){this.methods={}},W.prototype.init=function(){this.transport="",this.style="",this.methods={}},J.prototype.init=function(){this.location=null},V.prototype.init=function(){this.ports={}},Y.prototype.init=function(){"definitions"!==this.name&&this.unexpected(this.nsName),this.messages={},this.portTypes={},this.bindings={},this.services={},this.schemas={}},X.prototype.init=function(){},D.prototype.merge=function(e){return p.ok(e instanceof D),this.$targetNamespace===e.$targetNamespace&&(n.merge(this.complexTypes,e.complexTypes),n.merge(this.types,e.types),n.merge(this.elements,e.elements),n.merge(this.xmlns,e.xmlns)),this},D.prototype.addChild=function(e){if(!(e.$name in b)){if("include"===e.name||"import"===e.name){var t=e.$schemaLocation||e.$location;t&&this.includes.push({namespace:e.$namespace||e.$targetNamespace||this.$targetNamespace,location:t})}else"complexType"===e.name?this.complexTypes[e.$name]=e:"element"===e.name?this.elements[e.$name]=e:e.$name&&(this.types[e.$name]=e);this.children.pop()}},U.prototype.addChild=function(e){p.ok(e instanceof D);var t=e.$targetNamespace;this.schemas.hasOwnProperty(t)?console.error('Target-Namespace "'+t+'" already in use by another Schema!'):this.schemas[t]=e},A.prototype.addChild=function(e){"body"===e.name&&(this.use=e.$use,"encoded"===this.use&&(this.encodingStyle=e.$encodingStyle),this.children.pop())},O.prototype.addChild=function(e){"body"===e.name&&(this.use=e.$use,"encoded"===this.use&&(this.encodingStyle=e.$encodingStyle),this.children.pop())},q.prototype.addChild=function(e){"operation"===e.name&&(this.soapAction=e.$soapAction||"",this.style=e.$style||"",this.children.pop())},W.prototype.addChild=function(e){"binding"===e.name&&(this.transport=e.$transport,this.style=e.$style,this.children.pop())},J.prototype.addChild=function(e){"address"===e.name&&void 0!==e.$location&&(this.location=e.$location)},Y.prototype.addChild=function(e){e instanceof U?n.merge(this.schemas,e.schemas):e instanceof K?this.messages[e.$name]=e:"import"===e.name?(this.schemas[e.$namespace]=new D(e.$namespace,{}),this.schemas[e.$namespace].addChild(e)):e instanceof z?this.portTypes[e.$name]=e:e instanceof W?"http://schemas.xmlsoap.org/soap/http"!==e.transport&&"http://www.w3.org/2003/05/soap/bindings/HTTP/"!==e.transport||(this.bindings[e.$name]=e):e instanceof V&&(this.services[e.$name]=e),this.children.pop()},K.prototype.postProcess=function(e){var t=null,s=void 0,n=this.children||[],i=void 0,o=void 0,r=void 0,a=void 0;for(r in n)if("part"===(s=n[r]).name){t=s;break}if(t){if(t.$element){var c,u=[];delete this.parts,i=(o=w(t.$element)).prefix;var l=e.schemas[e.xmlns[i]];if(this.element=l.elements[o.name],!this.element)return;if(this.element.targetNSAlias=i,this.element.targetNamespace=e.xmlns[i],this.element.$lookupType=t.$element,(c=this.element.children).length>0)for(r=0;r<c.length;r++)u.push(this._getNestedLookupTypeString(c[r]));if(u.length>0){u=u.join("_").split("_").filter((function(e){return"^"!==e}));var h=e.schemas[this.element.targetNamespace].xmlns;for(r=0;r<u.length;r++)u[r]=this._createLookupTypeObject(u[r],h)}if(this.element.$lookupTypes=u,this.element.$type){a=w(this.element.$type);var d=l.xmlns&&l.xmlns[a.prefix]||e.xmlns[a.prefix];if(d)if(a.name in b);else{var f=(l=e.schemas[d]).complexTypes[a.name]||l.types[a.name]||l.elements[a.name];f&&(this.parts=f.description(e,l.xmlns))}}else{var m=this.element.description(e,l.xmlns);this.parts=m[o.name]}this.children.splice(0,1)}else for(this.parts={},delete this.element,r=0;t=this.children[r];r++)if("documentation"!==t.name){p.ok("part"===t.name,"Expected part element"),o=w(t.$type),i=e.xmlns[o.prefix],a=o.name;var y=e.schemas[i];this.parts[t.$name]=void 0!==y?e.schemas[i].types[a]||e.schemas[i].complexTypes[a]:t.$type,"object"==typeof this.parts[t.$name]&&(this.parts[t.$name].prefix=o.prefix,this.parts[t.$name].xmlns=i),this.children.splice(r--,1)}this.deleteFixedAttrs()}},K.prototype._createLookupTypeObject=function(e,t){var s=w(e),n=s.prefix,i=s.name.split("#"),o=i[0],r=i[1],a={};return a.$namespace=t[n],a.$type=n+":"+o,a.$name=r,a},K.prototype._getNestedLookupTypeString=function(e){var t="^",s=this.ignoredNamespaces.concat("xs");if(e.hasOwnProperty("$type")&&"string"==typeof e.$type&&-1===s.indexOf(e.$type.split(":")[0])&&(t+="_"+e.$type+"#"+e.$name),e.children.length>0){var n=this;e.children.forEach((function(e){var s=n._getNestedLookupTypeString(e).replace(/\^_/,"");s&&"string"==typeof s&&(t+="_"+s)}))}return t},q.prototype.postProcess=function(e,t){for(var s=this.children,n=0,i=void 0;i=s[n];n++)if("input"===i.name||"output"===i.name)if("binding"!==t){var o=w(i.$message).name,r=e.messages[o];r.postProcess(e),r.element?(e.messages[r.element.$name]=r,this[i.name]=r.element):this[i.name]=r,s.splice(n--,1)}else this[i.name]=i,s.splice(n--,1);this.deleteFixedAttrs()},z.prototype.postProcess=function(e){var t=this.children;if(void 0!==t){for(var s=0,n=void 0;n=t[s];s++)"operation"===n.name&&(n.postProcess(e,"portType"),this.methods[n.$name]=n,t.splice(s--,1));delete this.$name,this.deleteFixedAttrs()}},W.prototype.postProcess=function(e){var t=w(this.$type).name,s=e.portTypes[t],n=this.style,i=this.children;if(s){s.postProcess(e),this.methods=s.methods;for(var o=0,r=void 0;r=i[o];o++)if("operation"===r.name){r.postProcess(e,"binding"),i.splice(o--,1),r.style||(r.style=n);var a=this.methods[r.$name];a&&(a.style=r.style,a.soapAction=r.soapAction,a.inputSoap=r.input||null,a.outputSoap=r.output||null,a.inputSoap&&a.inputSoap.deleteFixedAttrs(),a.outputSoap&&a.outputSoap.deleteFixedAttrs())}}delete this.$name,delete this.$type,this.deleteFixedAttrs()},V.prototype.postProcess=function(e){var t=this.children,s=e.bindings;if(t&&t.length>0)for(var n=0,i=void 0;i=t[n];n++)if("port"===i.name){var o=s[w(i.$binding).name];o&&(o.postProcess(e),this.ports[i.$name]={location:i.location,binding:o},t.splice(n--,1))}delete this.$name,this.deleteFixedAttrs()},E.prototype.description=function(e){for(var t=this.children,s=0,n=void 0;n=t[s];s++)if(n instanceof P)return this.$name+"|"+n.description();return{}},P.prototype.description=function(e,t){for(var s,n=this.children,i=0,o=void 0;o=n[i];i++)if(o instanceof R||o instanceof L){s=o.description(e,t);break}if(s&&this.$base){var r=w(this.$base),a=r.name,p=t&&t[r.prefix]||e.xmlns[r.prefix],c=e.schemas[p],u=c&&(c.complexTypes[a]||c.types[a]||c.elements[a]);return s.getBase=function(){return u.description(e,c.xmlns)},s}return(this.$base?this.$base+"|":"")+this.children.map((function(e){return e.description()})).join(",")},M.prototype.description=function(e,t){for(var s=this.children,i={},o=0,r=void 0;r=s[o];o++)(r instanceof R||r instanceof L)&&(i=r.description(e,t));if(this.$base){var a=w(this.$base),p=a.name,c=t&&t[a.prefix]||e.xmlns[a.prefix],u=e.schemas[c];if(p in b)return this.$base;var l=u&&(u.complexTypes[p]||u.types[p]||u.elements[p]);if(l){var h=l.description(e,u.xmlns);i=n.defaultsDeep(h,i)}}return i},k.prototype.description=function(){return this[this.valueKey]},H.prototype.description=function(e,t){for(var s=this.children||[],n=0,i=void 0;i=s[n];n++)if(i instanceof L||i instanceof R||i instanceof B||i instanceof I||i instanceof F)return i.description(e,t);return{}},F.prototype.description=function(e,t){for(var s=this.children,n=0,i=void 0;i=s[n];n++)if(i instanceof M)return i.description(e,t);return{}},I.prototype.description=function(e,t){for(var s=this.children,n=0,i=void 0;i=s[n];n++)if(i instanceof M)return i.description(e,t);return{}},N.prototype.description=function(e,t){var s={},n=this.$name,i=!!this.$maxOccurs&&(isNaN(this.$maxOccurs)?"unbounded"===this.$maxOccurs:this.$maxOccurs>1);this.$minOccurs!==this.$maxOccurs&&i&&(n+="[]"),t&&t.__tns__&&(this.$targetNamespace=t.__tns__);var o=this.$type||this.$ref;if(o){var r=(o=w(o)).name,a=t&&t[o.prefix]||e.xmlns[o.prefix],p=e.schemas[a],c=p&&(this.$type?p.complexTypes[r]||p.types[r]:p.elements[r]);if(a&&e.schemas[a]&&(t=e.schemas[a].xmlns),c&&!(r in b))if(r in e.descriptions.types)this.$ref?s=e.descriptions.types[r]:s[n]=e.descriptions.types[r];else{var u={};e.descriptions.types[r]=u;var l=c.description(e,t);"string"==typeof l?u=l:Object.keys(l).forEach((function(e){u[e]=l[e]})),this.$ref?s=u:s[n]=u,"object"==typeof u&&(u.targetNSAlias=o.prefix,u.targetNamespace=a),e.descriptions.types[r]=u}else s[n]=this.$type}else{var h=this.children;s[n]={};for(var d=0,f=void 0;f=h[d];d++)f instanceof H&&(s[n]=f.description(e,t))}return s},B.prototype.description=R.prototype.description=function(e,t){for(var s=this.children,n={},i=0,o=void 0;o=s[i];i++)if(!(o instanceof j)){var r=o.description(e,t);for(var a in r)n[a]=r[a]}return n},L.prototype.description=function(e,t){for(var s=this.children,n={},i=0,o=void 0;o=s[i];i++){var r=o.description(e,t);for(var a in r)n[a]=r[a]}return n},K.prototype.description=function(e){if(this.element)return this.element&&this.element.description(e);var t={};return t[this.$name]=this.parts,t},z.prototype.description=function(e){var t={};for(var s in this.methods){var n=this.methods[s];t[s]=n.description(e)}return t},q.prototype.description=function(e){var t=this.input?this.input.description(e):null,s=this.output?this.output.description(e):null;return{input:t&&t[Object.keys(t)[0]],output:s&&s[Object.keys(s)[0]]}},W.prototype.description=function(e){var t={};for(var s in this.methods){var n=this.methods[s];t[s]=n.description(e)}return t},V.prototype.description=function(e){var t={};for(var s in this.ports){var n=this.ports[s];t[s]=n.binding.description(e)}return t};var te=function(e,t,s){var n,i,o=this;if(this.uri=t,this.callback=function(){},this._includesWsdl=[],this.WSDL_CACHE=(s||{}).WSDL_CACHE||{},this._initializeOptions(s),"string"==typeof e)e=65279===(i=e).charCodeAt(0)?i.slice(1):i,n=this._fromXML;else{if("object"!=typeof e)throw new Error("WSDL letructor takes either an XML string or service definition");n=this._fromServices}Promise.resolve(!0).then((function(){try{n.call(o,e)}catch(e){return o.callback(e.message)}o.processIncludes().then((function(){o.definitions.deleteFixedAttrs();var e=o.services=o.definitions.services;if(e)for(var t in e)e[t].postProcess(o.definitions);var s=o.definitions.complexTypes;if(s)for(var n in s)s[n].deleteFixedAttrs();var i=o.definitions.bindings;for(var r in i){var a=i[r];if(void 0===a.style&&(a.style="document"),"document"===a.style){var p=a.methods,c=a.topElements={};for(var u in p)if(p[u].input){var l=p[u].input.$name,h="";p[u].output&&(h=p[u].output.$name),c[l]={methodName:u,outputName:h}}}}o.xmlnsInEnvelope=o._xmlnsMap(),o.callback(null,o)})).catch((function(e){return o.callback(e)}))}))};function se(e){return e&&":"!==e.charAt(e.length-1)?e+":":e}function ne(e){return e&&":"===e.charAt(e.length-1)?e.substring(0,e.length-1):e}function ie(e,t){var s;return(s=t.WSDL_CACHE[e])?s:oe(e,t)}function oe(e,t){return d(this,void 0,void 0,(function(){var s,n;return f(this,(function(i){switch(i.label){case 0:return s=t.WSDL_CACHE||{},t.wsdl_headers,t.wsdl_options,[4,t.httpClient.get(e,{responseType:"text"}).toPromise()];case 1:return n=i.sent(),[4,new Promise((function(i){var o=new te(n,e,t);s[e]=o,o.WSDL_CACHE=s,o.onReady(i(o))}))];case 2:return[2,i.sent()]}}))}))}function re(e,t,s){this._username=e,this._password=t,this.defaults={},n.merge(this.defaults,s)}te.prototype.ignoredNamespaces=["tns","targetNamespace","typedNamespace"],te.prototype.ignoreBaseNameSpaces=!1,te.prototype.valueKey="$value",te.prototype.xmlKey="$xml",te.prototype._initializeOptions=function(e){this._originalIgnoredNamespaces=(e||{}).ignoredNamespaces,this.options={};var t=e?e.ignoredNamespaces:null;t&&(Array.isArray(t.namespaces)||"string"==typeof t.namespaces)?t.override?this.options.ignoredNamespaces=t.namespaces:this.options.ignoredNamespaces=this.ignoredNamespaces.concat(t.namespaces):this.options.ignoredNamespaces=this.ignoredNamespaces,this.options.valueKey=e.valueKey||this.valueKey,this.options.xmlKey=e.xmlKey||this.xmlKey,void 0!==e.escapeXML?this.options.escapeXML=e.escapeXML:this.options.escapeXML=!0,void 0!==e.returnFault?this.options.returnFault=e.returnFault:this.options.returnFault=!1,this.options.handleNilAsNull=!!e.handleNilAsNull,void 0!==e.namespaceArrayElements?this.options.namespaceArrayElements=e.namespaceArrayElements:this.options.namespaceArrayElements=!0,this.options.wsdl_headers=e.wsdl_headers,this.options.wsdl_options=e.wsdl_options,e.httpClient&&(this.options.httpClient=e.httpClient),e.request&&(this.options.request=e.request);var s=e?e.ignoreBaseNameSpaces:null;this.options.ignoreBaseNameSpaces=null!=s?s:this.ignoreBaseNameSpaces,this.options.forceSoap12Headers=e.forceSoap12Headers,this.options.customDeserializer=e.customDeserializer,void 0!==e.overrideRootElement&&(this.options.overrideRootElement=e.overrideRootElement),this.options.useEmptyTag=!!e.useEmptyTag},te.prototype.onReady=function(e){e&&(this.callback=e)},te.prototype._processNextInclude=function(e){return d(this,void 0,void 0,(function(){var t,s,i,o,r;return f(this,(function(p){switch(p.label){case 0:return t=this,(s=e.shift())?((/^https?:/.test(t.uri)||/^https?:/.test(s.location))&&(o=a.resolve(t.uri||"",s.location)),(i=n.assign({},this.options)).ignoredNamespaces=this._originalIgnoredNamespaces||this.options.ignoredNamespaces,i.WSDL_CACHE=this.WSDL_CACHE,[4,ie(o,i)]):[2];case 1:return r=p.sent(),t._includesWsdl.push(r),r.definitions instanceof Y?n.mergeWith(t.definitions,r.definitions,(function(e,t){return e instanceof D?e.merge(t):void 0})):t.definitions.schemas[s.namespace||r.definitions.$targetNamespace]=(c=t.definitions.schemas[s.namespace||r.definitions.$targetNamespace],u=r.definitions,n.mergeWith(c||{},u,(function(e,t){return n.isArray(e)?e.concat(t):void 0}))),[2,t._processNextInclude(e)]}var c,u}))}))},te.prototype.processIncludes=function(){return d(this,void 0,void 0,(function(){var e,t,s,n;return f(this,(function(i){for(s in e=this.definitions.schemas,t=[],e)n=e[s],t=t.concat(n.includes||[]);return[2,this._processNextInclude(t)]}))}))},te.prototype.describeServices=function(){var e={};for(var t in this.services){var s=this.services[t];e[t]=s.description(this.definitions)}return e},te.prototype.toXML=function(){return this.xml||""},te.prototype.xmlToObject=function(e,t){var i=this,o="function"==typeof t?{}:s.parser(!0),r=null,a={},p={};p=this.options.forceSoap12Headers?{Envelope:{Header:{Security:{UsernameToken:{Username:"string",Password:"string"}}},Body:{Code:{Value:"string",Subcode:{Value:"string"}},Reason:{Text:"string"},statusCode:"number",Detail:"object"}}}:{Envelope:{Header:{Security:{UsernameToken:{Username:"string",Password:"string"}}},Body:{Fault:{faultcode:"string",faultstring:"string",detail:"string"}}}};var c,u=[{name:null,object:a,schema:p}],l={},h={};if(o.onopentag=function(e){var t,s,n=e.name,a=e.attributes,p=w(n).name,d=u[u.length-1],f=d.schema,m={},y=!1,v=!1,g={},x=p;if(!r&&"Body"===d.name&&"Fault"!==p){var b=i.definitions.messages[p];if(!b)try{var S=!1;/Response$/.test(p)?(!0,p=p.replace(/Response$/,"")):/Request$/.test(p)?(S=!0,p=p.replace(/Request$/,"")):/Solicit$/.test(p)&&(S=!0,p=p.replace(/Solicit$/,""));var _=i.definitions.portTypes,$=_[Object.keys(_)[0]];p=S?$.methods[p].input.$name:$.methods[p].output.$name,b=i.definitions.messages[p],i.definitions.messages[x]=i.definitions.messages[p]}catch(e){i.options.returnFault&&o.onerror(e)}f=b.description(i.definitions),r=x}for(t in a.href&&(c=a.href.substr(1),h[c]||(h[c]={hrefs:[],obj:null}),h[c].hrefs.push({par:d.object,key:p,obj:g})),(c=a.id)&&(h[c]||(h[c]={hrefs:[],obj:null})),a)/^xmlns:|^xmlns$/.test(t)?l[w(t).name]=a[t]:(y=!0,m[t]=a[t]);for(t in m){var T=w(t);if("nil"===T.name&&"http://www.w3.org/2001/XMLSchema-instance"===l[T.prefix]&&m[t]&&("true"===m[t].toLowerCase()||"1"===m[t])){v=!0;break}}y&&(g[i.options.attributesKey]=m);var C=m["xsi:type"];if(C){var N=w(C),j=void 0;j="__tns__"===N.prefix?l[N.prefix]||l.xmlns:l[N.prefix];var A=i.findSchemaObject(j,N.name);A&&(s=A.description(i.definitions))}f&&f[p+"[]"]&&(p+="[]"),u.push({name:x,object:g,schema:s||f&&f[p],id:a.id,nil:v})},o.onclosetag=function(e){var t=u.pop(),s=t.object,o=u[u.length-1],r=o.object,a=o.schema,p=w(e).name;if("string"!=typeof t.schema||"string"!==t.schema&&"string"!==t.schema.split(":")[1]||"object"==typeof s&&0===Object.keys(s).length&&(s=t.object=""),!0===t.nil){if(!i.options.handleNilAsNull)return;s=null}n.isPlainObject(s)&&!Object.keys(s).length&&(s=null),a&&a[p+"[]"]?(r[p]||(r[p]=[]),r[p].push(s)):p in r?(Array.isArray(r[p])||(r[p]=[r[p]]),r[p].push(s)):r[p]=s,t.id&&(h[t.id].obj=s)},o.oncdata=function(e){var t=e;if((e=T(e)).length)if(/<\?xml[\s\S]+\?>/.test(e)){var s=u[u.length-1],n=i.xmlToObject(e);s.object[i.options.attributesKey]?s.object[i.options.valueKey]=n:s.object=n}else o.ontext(t)},o.onerror=function(e){throw o.resume(),{Fault:{faultcode:500,faultstring:"Invalid XML",detail:new Error(e).message,statusCode:500}}},o.ontext=function(e){var t=e;if((e=T(e)).length){var s,n=u[u.length-1],o=w(n.schema).name;i.options&&i.options.customDeserializer&&i.options.customDeserializer[o]?s=i.options.customDeserializer[o](e,n):"int"===o||"integer"===o?s=parseInt(e,10):"bool"===o||"boolean"===o?s="true"===e.toLowerCase()||"1"===e:"dateTime"===o||"date"===o?s=new Date(e):(i.options.preserveWhitespace&&(e=t),s="string"!=typeof n.object?e:n.object+e),n.object[i.options.attributesKey]?n.object[i.options.valueKey]=s:n.object=s}},"function"==typeof t){var d=s.createStream(!0);return d.on("opentag",o.onopentag),d.on("closetag",o.onclosetag),d.on("cdata",o.oncdata),d.on("text",o.ontext),void e.pipe(d).on("error",(function(e){t(e)})).on("end",(function(){var e;try{e=f()}catch(e){return t(e)}t(null,e)}))}return o.write(e).close(),f();function f(){for(var e in h)for(var t=h[e],s=0;s<t.hrefs.length;s++)n.assign(t.hrefs[s].obj,t.obj);if(a.Envelope){var i=a.Envelope.Body,o=void 0;if(i&&i.Fault){if(i.Fault.Code){r=i.Fault.Code.Value,p=i.Fault.Reason.Text.$value,c=i.Fault.Detail.info;o=new Error(r+": "+p+(c?": "+c:""))}else{var r=i.Fault.faultcode&&i.Fault.faultcode.$value,p=i.Fault.faultstring&&i.Fault.faultstring.$value,c=i.Fault.detail&&i.Fault.detail.$value;r=r||i.Fault.faultcode,p=p||i.Fault.faultstring,c=c||i.Fault.detail;new Error(r+": "+p+(c?": "+c:""))}throw o.root=a,i.Fault}return a.Envelope}return a}},te.prototype.findSchemaObject=function(e,t){if(!e||!t)return null;var s=null;if(this.definitions.schemas){var n=this.definitions.schemas[e];n&&(-1!==t.indexOf(":")&&(t=t.substring(t.indexOf(":")+1,t.length)),s=n.complexTypes[t]||n.types[t]||n.elements[t])}return s},te.prototype.objectToDocumentXML=function(e,t,s,n,i){if(t&&t._xml)return t._xml;var o={};o[e]=t;var r=i?this.findSchemaObject(n,i):null;return this.objectToXML(o,null,s,n,!0,null,r)},te.prototype.objectToRpcXML=function(e,t,s,n,i){var o=[],r=this.definitions;for(var a in s=s||x(r.xmlns,n),n=n||r.xmlns[s],s="__tns__"===s?"":s+":",o.push(["<",s,e,">"].join("")),t)if(t.hasOwnProperty(a)&&"_xmlns"!==a){var p=t[a],c=(i?"":s)+a,u=[];if("object"==typeof p&&p.hasOwnProperty(this.options.attributesKey)){var l=p[this.options.attributesKey];for(var h in l)u.push(" "+h+'="'+l[h]+'"')}o.push(["<",c].concat(u).concat(">").join("")),o.push("object"==typeof p?this.objectToXML(p,a,s,n):S(p)),o.push(["</",c,">"].join(""))}return o.push(["</",s,e,">"].join("")),o.join("")},te.prototype.isIgnoredNameSpace=function(e){return this.options.ignoredNamespaces.indexOf(e)>-1},te.prototype.filterOutIgnoredNameSpace=function(e){var t=ne(e);return this.isIgnoredNameSpace(t)?"":t},te.prototype.objectToXML=function(e,t,s,n,i,o,r,a){var p=this.definitions.schemas[n],c=s?s.parent:void 0;void 0!==c&&(s=s.current),c=ne(c),this.isIgnoredNameSpace(c)&&(c="");var u=!p,l=p&&"qualified"===p.$elementFormDefault,h=[],d=(s||l)&&"__tns__"!==s,f="";n&&i&&(this.options.overrideRootElement&&this.options.overrideRootElement.xmlnsAttributes?this.options.overrideRootElement.xmlnsAttributes.forEach((function(e){f+=" "+e.name+'="'+e.value+'"'})):(d&&!this.isIgnoredNameSpace(s)&&(f+=" xmlns:"+s+'="'+n+'"'),(l||u)&&(f+=' xmlns="'+n+'"'))),a?a.pushContext():(a=new v).declareNamespace(s,n),!o||this.options.overrideRootElement&&this.options.overrideRootElement.xmlnsAttributes||(f=o);var m,y,g="";if(this.options.overrideRootElement&&i?g=this.options.overrideRootElement.namespace:d&&(l||i||u)&&!this.isIgnoredNameSpace(s)&&(g=s),Array.isArray(e))for(m=0,y=e.length;m<y;m++){var x=e[m],b=this.processAttributes(x,a),_=c||g,$=this.objectToXML(x,t,s,n,!1,null,r,a),T=["<",se(_),t,b,f];""===$&&this.options.useEmptyTag?(T.push(" />"),h.push(T.join(""))):(T.push(">"),(this.options.namespaceArrayElements||0===m)&&h.push(T.join("")),h.push($),(this.options.namespaceArrayElements||m===y-1)&&h.push(["</",se(_),t,">"].join("")))}else if("object"==typeof e){for(t in e)if(e.hasOwnProperty(t)&&t!==this.options.attributesKey){if(t===this.options.xmlKey)return a.popContext(),e[t];if(t===this.options.valueKey)return a.popContext(),S(e[t]);var C=e[t];if(void 0!==C){var N=this.processAttributes(C,a),j="",A="",O=!1,E=/^([^:]+):([^:]+)$/.exec(t);if(E?(A=E[1]+":",t=E[2]):":"===t[0]&&(O=!0,t=t.substr(1)),i)j=this.objectToXML(C,t,s,n,!1,null,r,a);else if(this.definitions.schemas)if(p){var P=this.findChildSchemaObject(r,t);if(P&&(P.$type&&-1===P.$type.indexOf("xsd:")||P.$ref||P.$name)){var M="",L="",k=void 0,H="",F=P.$ref||P.$name;if(F){L=(F=w(F)).name,"__tns__"===F.prefix?(k=P.$targetNamespace,M=a.registerNamespace(k),this.isIgnoredNameSpace(M)&&(M=s)):(M=F.prefix,this.isIgnoredNameSpace(M)&&(M=s),k=p.xmlns[M]||this.definitions.xmlns[M]);var I=!1;P.$name&&void 0===P.targetNamespace&&(I="unqualified"===P.$form||"qualified"!==P.$form&&"qualified"!==p.$elementFormDefault),I&&(M=""),k&&M&&a.declareNamespace(M,k)&&(f+=H=" xmlns:"+M+'="'+k+'"')}var R=void 0;if(P.$type){var B=w(P.$type),K=B.prefix,X=p.xmlns[K]||this.definitions.xmlns[K];k=X,"http://www.w3.org/2001/XMLSchema"!==X&&"__tns__"!==K&&a.addNamespace(K,X),R=this.findSchemaType(B.name,X)||P}else R=this.findSchemaObject(k,L)||P;P.$baseNameSpace&&this.options.ignoreBaseNameSpaces&&(M=s,k=n),this.options.ignoreBaseNameSpaces&&(M="",k=""),g=M,Array.isArray(C)?M={current:M,parent:g}:H=null,j=this.objectToXML(C,t,M,k,!1,H,R,a)}else if(e[this.options.attributesKey]&&e[this.options.attributesKey].xsi_type){this.findChildSchemaObject(e[this.options.attributesKey].xsi_type.type,e[this.options.attributesKey].xsi_type.xmlns);A=e[this.options.attributesKey].xsi_type.prefix,a.addNamespace(e[this.options.attributesKey].xsi_type.prefix,e[this.options.attributesKey].xsi_type.xmlns),j=this.objectToXML(C,t,e[this.options.attributesKey].xsi_type.prefix,e[this.options.attributesKey].xsi_type.xmlns,!1,null,null,a)}else Array.isArray(C)&&(t=A+t),j=this.objectToXML(C,t,s,n,!1,null,null,a)}else j=this.objectToXML(C,t,s,n,!1,null,null,a);g=ne(g),d&&!l&&i&&!this.options.overrideRootElement?g=s:this.isIgnoredNameSpace(g)&&(g="");var D=!j&&this.options.useEmptyTag;Array.isArray(C)||h.push(["<",O?"":se(A||g),t,N,f,null===C?' xsi:nil="true"':"",D?" />":">"].join("")),D||(h.push(j),Array.isArray(C)||h.push(["</",O?"":se(A||g),t,">"].join("")))}}}else void 0!==e&&h.push(this.options.escapeXML?S(e):e);return a.popContext(),h.join("")},te.prototype.processAttributes=function(e,t){var s="";null===e&&(e=[]);var n=e[this.options.attributesKey];if(n&&n.xsi_type){var i=n.xsi_type,o=i.prefix||i.namespace;o?t.declareNamespace(o,i.xmlns):o=t.registerNamespace(i.xmlns),i.prefix=o}if(n)for(var r in n)if("xsi_type"!==r)s+=" "+r+'="'+S(n[r])+'"';else{var a=n[r];s+=' xsi:type="'+a.prefix+":"+a.type+'"',s+=" xmlns:"+a.prefix+'="'+a.xmlns+'"'}return s},te.prototype.findSchemaType=function(e,t){if(!this.definitions.schemas||!e||!t)return null;var s=this.definitions.schemas[t];return s&&s.complexTypes?s.complexTypes[e]:null},te.prototype.findChildSchemaObject=function(e,t,s){if(!e||!t)return null;if(s||(s=[]),s.indexOf(e)>=0)return null;s=s.concat([e]);var n,i=null,o=0;if(Array.isArray(e.$lookupTypes)&&e.$lookupTypes.length){var r=e.$lookupTypes;for(o=0;o<r.length;o++){var a=r[o];if(a.$name===t){i=a;break}}}var p,c=e;if(c.$name===t&&"element"===c.name)return c;if(c.$ref&&w(c.$ref).name===t)return c;if(c.$type&&1===s.length){var u=w(c.$type);p="__tns__"===u.prefix?e.$targetNamespace:this.definitions.xmlns[u.prefix];var l=this.findSchemaType(u.name,p);if(l)return this.findChildSchemaObject(l,t,s)}if(c.children)for(o=0;(n=c.children[o])&&!(i=this.findChildSchemaObject(n,t,s));o++)if(n.$base){var h=w(n.$base),d="__tns__"===h.prefix?"":h.prefix;p=n.xmlns[h.prefix]||this.definitions.xmlns[h.prefix];var f=this.findSchemaType(h.name,p);if(f&&(i=this.findChildSchemaObject(f,t,s))){i.$baseNameSpace=d,i.$type=d+":"+t;break}}return i||c.$name!==t?i:c},te.prototype._parse=function(e){var t=this,n=s.parser(!0),i=[],o=null,r=null,a=null,c=t.options;return n.onopentag=function(e){var s,n=e.name,p=e.attributes,u=i[i.length-1];if(u)try{u.startElement(i,n,p,c)}catch(e){if(t.options.strict)throw e;i.push(new C(n,p,c))}else if("definitions"===(s=w(n).name))o=new Y(n,p,c),i.push(o);else{if("schema"!==s)throw new Error("Unexpected root element of WSDL or include");o=new Y("definitions",{},{}),r=new U("types",{},{}),a=new D(n,p,c),r.addChild(a),o.addChild(r),i.push(a)}},n.onclosetag=function(e){var t=i[i.length-1];p.ok(t,"Unmatched close tag: "+e),t.endElement(i,e)},n.write(e).close(),o},te.prototype._fromXML=function(e){this.definitions=this._parse(e),this.definitions.descriptions={types:{}},this.xml=e},te.prototype._fromServices=function(e){},te.prototype._xmlnsMap=function(){var e=this.definitions.xmlns,t="";for(var s in e)if(""!==s&&"__tns__"!==s){var n=e[s];switch(n){case"http://xml.apache.org/xml-soap":case"http://schemas.xmlsoap.org/wsdl/":case"http://schemas.xmlsoap.org/wsdl/soap/":case"http://schemas.xmlsoap.org/wsdl/soap12/":case"http://schemas.xmlsoap.org/soap/encoding/":case"http://www.w3.org/2001/XMLSchema":continue}~n.indexOf("http://schemas.xmlsoap.org/")||~n.indexOf("http://www.w3.org/")||~n.indexOf("http://xml.apache.org/")||(t+=" xmlns:"+s+'="'+n+'"')}return t},re.prototype.addHeaders=function(e){e.Authorization="Basic "+new r.Buffer(this._username+":"+this._password||"").toString("base64")},re.prototype.toXML=function(){return""},re.prototype.addOptions=function(e){n.merge(e,this.defaults)};var ae=["PasswordDigest","PasswordText"];function pe(e,t,s){s=s||{},this._username=e,this._password=t,"string"==typeof s?(this._passwordType=s||"PasswordText",s={}):this._passwordType=s.passwordType?s.passwordType:"PasswordText",-1===ae.indexOf(this._passwordType)&&(this._passwordType="PasswordText"),this._hasTimeStamp=!s.hasTimeStamp&&"boolean"!=typeof s.hasTimeStamp||!!s.hasTimeStamp,null!=s.hasNonce&&(this._hasNonce=!!s.hasNonce),this._hasTokenCreated=!s.hasTokenCreated&&"boolean"!=typeof s.hasTokenCreated||!!s.hasTokenCreated,null!=s.actor&&(this._actor=s.actor),null!=s.mustUnderstand&&(this._mustUnderstand=!!s.mustUnderstand)}function ce(e,t){this._token=e,this.defaults={},n.merge(this.defaults,t)}function ue(e,t,s,n){"object"==typeof e?(this.defaults=e,this.defaults.ntlm=!0):this.defaults={ntlm:!0,username:e,password:t,domain:s,workstation:n}}pe.prototype.toXML=function(){function e(e){function t(e){return e<10?"0"+e:e}return e.getUTCFullYear()+"-"+t(e.getUTCMonth()+1)+"-"+t(e.getUTCDate())+"T"+t(e.getUTCHours())+":"+t(e.getUTCMinutes())+":"+t(e.getUTCSeconds())+"Z"}var t,s,n=new Date,a=e(n),p="";this._hasTimeStamp&&(p='<wsu:Timestamp wsu:Id="Timestamp-'+a+'"><wsu:Created>'+a+"</wsu:Created><wsu:Expires>"+e(new Date(n.getTime()+6e5))+"</wsu:Expires></wsu:Timestamp>");return(this._hasNonce||"PasswordText"!==this._passwordType)&&(s=o.stringify(i(a+Math.random(),""))),"PasswordText"===this._passwordType?(t='<wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">'+this._password+"</wsse:Password>",s&&(t+='<wsse:Nonce EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary">'+s+"</wsse:Nonce>")):t='<wsse:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordDigest">'+function(e,t,s){var n=new r.Buffer(e||"","base64").toString("binary");return o.stringify(i(n+t+s,""))}(s,a,this._password)+'</wsse:Password><wsse:Nonce EncodingType="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-soap-message-security-1.0#Base64Binary">'+s+"</wsse:Nonce>","<wsse:Security "+(this._actor?'soap:actor="'+this._actor+'" ':"")+(this._mustUnderstand?'soap:mustUnderstand="1" ':"")+'xmlns:wsse="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd" xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">'+p+'<wsse:UsernameToken xmlns:wsu="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd" wsu:Id="SecurityToken-'+a+'"><wsse:Username>'+this._username+"</wsse:Username>"+t+(this._hasTokenCreated?"<wsu:Created>"+a+"</wsu:Created>":"")+"</wsse:UsernameToken></wsse:Security>"},ce.prototype.addHeaders=function(e){e.Authorization="Bearer "+this._token},ce.prototype.toXML=function(){return""},ce.prototype.addOptions=function(e){n.merge(e,this.defaults)},ue.prototype.addHeaders=function(e){e.Connection="keep-alive"},ue.prototype.toXML=function(){return""},ue.prototype.addOptions=function(e){n.merge(e,this.defaults)};var le={BasicAuthSecurity:re,BearerSecurity:ce,WSSecurity:pe,NTLMSecurity:ue},he=function(){function e(){this.preambleCRLF=!0,this.postambleCRLF=!0}return e.prototype.build=function(e,t){var s=[];function n(e){return"number"==typeof e&&(e=e.toString()),s.push(e)}this.preambleCRLF&&n("\r\n"),e.forEach((function(e){var s="--"+t+"\r\n";Object.keys(e).forEach((function(t){"body"!==t&&(s+=t+": "+e[t]+"\r\n")})),n(s+="\r\n"),n(e.body),n("\r\n")})),n("--"+t+"--"),this.postambleCRLF&&n("\r\n");var i=s.map((function(e){return"string"==typeof e?e.length:e.byteLength})).reduce((function(e,t){return e+t}),0),o=new Uint8Array(i),r=0;return s.forEach((function(e){if("string"==typeof e)for(var t=0;t<e.length;r++,t++)o[r]=255&e.charCodeAt(t);else for(t=0;t<e.byteLength;r++,t++)o[r]=e[t]})),o.buffer},e}(),de=function(){function e(e,t,s,n){this.mimetype=e,this.contentId=t,this.name=s,this.body=n}return e.fromFormFiles=function(t){void 0===t&&(t=[]),t instanceof FileList&&(t=Array.from(t));var s=t.map((function(t){return new Promise((function(s){var n=new FileReader;n.readAsArrayBuffer(t),n.onload=function(n){var i=n.target.result,o=new Uint8Array(i),r=new e(t.type,t.contentId||t.name,t.name,o);s(r)}}))}));return Promise.all(s)},e}(),fe=/[^a-z$_0-9]/i,me=function(e,t,s){s=s||{},this.wsdl=e,this._initializeOptions(s),this._initializeServices(t),this.httpClient=s.httpClient;var n={multiArgs:!0};s.overridePromiseSuffix&&(n.suffix=s.overridePromiseSuffix),Promise.all([this,n])};me.prototype.addSoapHeader=function(e,t,s,n){return this.soapHeaders||(this.soapHeaders=[]),"object"==typeof e&&(e=this.wsdl.objectToXML(e,t,s,n,!0)),this.soapHeaders.push(e)-1},me.prototype.changeSoapHeader=function(e,t,s,n,i){this.soapHeaders||(this.soapHeaders=[]),"object"==typeof t&&(t=this.wsdl.objectToXML(t,s,n,i,!0)),this.soapHeaders[e]=t},me.prototype.getSoapHeaders=function(){return this.soapHeaders},me.prototype.clearSoapHeaders=function(){this.soapHeaders=null},me.prototype.addHttpHeader=function(e,t){this.httpHeaders||(this.httpHeaders={}),this.httpHeaders[e]=t},me.prototype.getHttpHeaders=function(){return this.httpHeaders},me.prototype.clearHttpHeaders=function(){this.httpHeaders={}},me.prototype.addBodyAttribute=function(e,t,s,n){if(this.bodyAttributes||(this.bodyAttributes=[]),"object"==typeof e){var i="";Object.getOwnPropertyNames(e).forEach((function(t,s,n){i+=" "+t+'="'+e[t]+'"'})),e=i}" "!==e.substr(0,1)&&(e=" "+e),this.bodyAttributes.push(e)},me.prototype.getBodyAttributes=function(){return this.bodyAttributes},me.prototype.clearBodyAttributes=function(){this.bodyAttributes=null},me.prototype.setEndpoint=function(e){this.endpoint=e,this._initializeServices(e)},me.prototype.describe=function(){this.wsdl.definitions.types;return this.wsdl.describeServices()},me.prototype.setSecurity=function(e){this.security=e},me.prototype.setSOAPAction=function(e){this.SOAPAction=e},me.prototype._initializeServices=function(e){var t=this.wsdl.definitions.services;for(var s in t)this[s]=this._defineService(t[s],e)},me.prototype._initializeOptions=function(e){this.streamAllowed=e.stream,this.normalizeNames=e.normalizeNames,this.wsdl.options.attributesKey=e.attributesKey||"attributes",this.wsdl.options.envelopeKey=e.envelopeKey||"soap",this.wsdl.options.preserveWhitespace=!!e.preserveWhitespace,void 0!==e.ignoredNamespaces&&void 0!==e.ignoredNamespaces.override&&!0===e.ignoredNamespaces.override&&void 0!==e.ignoredNamespaces.namespaces&&(this.wsdl.options.ignoredNamespaces=e.ignoredNamespaces.namespaces),void 0!==e.overrideRootElement&&(this.wsdl.options.overrideRootElement=e.overrideRootElement),this.wsdl.options.forceSoap12Headers=!!e.forceSoap12Headers},me.prototype._defineService=function(e,t){var s=e.ports,n={};for(var i in s)n[i]=this._definePort(s[i],t||s[i].location);return n},me.prototype._definePort=function(e,t){var s=t,n=e.binding.methods,i={};for(var o in n){i[o]=this._defineMethod(n[o],s),this[this.normalizeNames?o.replace(fe,"_"):o]=i[o]}return i},me.prototype._defineMethod=function(e,t){var s=this;return function(n,i,o){return s._invoke(e,n,t,i,o)}},me.prototype._invoke=function(e,t,s,i,o){var r=this,a=e.$name,h=e.input,d=e.output,f=e.style,y=this.wsdl.definitions,v=this.wsdl.options.envelopeKey,x=y.$targetNamespace,b="",w="",S=null,_=null,$=g(y.xmlns,x),T={"Content-Type":"text/xml; charset=utf-8"},C="xmlns:"+v+'="http://schemas.xmlsoap.org/soap/envelope/"';for(var N in this.wsdl.options.forceSoap12Headers&&(T["Content-Type"]="application/soap+xml; charset=utf-8",C="xmlns:"+v+'="http://www.w3.org/2003/05/soap-envelope"'),_=this.SOAPAction?this.SOAPAction:void 0!==e.soapAction&&null!==e.soapAction?e.soapAction:(x.lastIndexOf("/")!==x.length-1?x+"/":x)+a,this.wsdl.options.forceSoap12Headers||(T.SOAPAction='"'+_+'"'),i=i||{},this.httpHeaders)T[N]=this.httpHeaders[N];for(var j in o)T[j]=o[j];r.security&&r.security.addHeaders&&r.security.addHeaders(T),r.security&&r.security.addOptions&&r.security.addOptions(i),"rpc"!==f||!h.parts&&"element"!==h.name&&null!==t?(p.ok(!f||"document"===f,"invalid message definition for rpc style binding"),w=r.wsdl.objectToDocumentXML(h.$name,t,h.targetNSAlias,h.targetNamespace,h.$type||h.$lookupType)):(p.ok(!f||"rpc"===f,"invalid message definition for document style binding"),w=r.wsdl.objectToRpcXML(a,t,$,x,"element"!==h.name),"encoded"===e.inputSoap&&(b='soap:encodingStyle="http://schemas.xmlsoap.org/soap/encoding/" ')),S='<?xml version="1.0" encoding="utf-8"?><'+v+":Envelope "+C+' xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" '+b+this.wsdl.xmlnsInEnvelope+">"+(r.soapHeaders||r.security?"<"+v+":Header>"+(r.soapHeaders?r.soapHeaders.join("\n"):"")+(r.security&&!r.security.postProcess?r.security.toXML():"")+"</"+v+":Header>":"")+"<"+v+":Body"+(r.bodyAttributes?r.bodyAttributes.join(" "):"")+(r.security&&r.security.postProcess?' Id="_0"':"")+">"+w+"</"+v+":Body></"+v+":Envelope>",r.security&&r.security.postProcess&&(S=r.security.postProcess(S,v)),i&&i.postProcess&&(S=i.postProcess(S)),r.lastMessage=w,r.lastRequest=S,r.lastEndpoint=s;return u.from(de.fromFormFiles(i.attachments)).pipe(l.map((function(e){var t,s;if(!e.length)return S;if(i.forceMTOM||e.length>0){var n=c(),o=c(),r=null;if(T["Content-Type"].indexOf("action")>-1)try{for(var a=m(T["Content-Type"].split("; ")),p=a.next();!p.done;p=a.next()){var u=p.value;u.indexOf("action")>-1&&(r=u)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(s=a.return)&&s.call(a)}finally{if(t)throw t.error}}T["Content-Type"]='multipart/related; type="application/xop+xml"; start="<'+n+'>"; start-info="text/xml"; boundary="'+o+'"',r&&(T["Content-Type"]=T["Content-Type"]+"; "+r);var l=[{"Content-Type":'application/xop+xml; charset=UTF-8; type="text/xml"',"Content-ID":"<"+n+">",body:S}];return e.forEach((function(e){l.push({"Content-Type":e.mimetype+";","Content-Transfer-Encoding":"binary","Content-ID":"<"+(e.contentId||e.name)+">","Content-Disposition":'attachment; name="'+e.name+'"; filename="'+e.name+'"',body:e.body})})),(new he).build(l,o)}})),l.flatMap((function(e){return r.httpClient.post(s,e,{headers:T,responseType:"text",observe:"response"}).pipe(l.map((function(e){return r.lastResponse=e.body,r.lastResponseHeaders=e&&e.headers,function(e,t){var s;try{s=r.wsdl.xmlToObject(e)}catch(s){if(!d||!d.$lookupTypes){var i=n.isObject(e)?e:function(e){try{return JSON.parse(e)}catch(e){return}}(e);if(i)return{err:null,response:t,responseBody:i,header:void 0,xml:S}}throw s.response=t,s.body=e,s}return function(e,t,s){var n=null;if(!d)return{err:null,response:null,responseBody:t,header:e.Header,xml:S};if(!e.html&&!e.Body)return{err:null,obj:e,responseBody:t,header:e.Header,xml:S};if("object"!=typeof e.Body){var i=new Error("Cannot parse response");return i.response=s,i.body=t,{err:i,obj:e,responseBody:t,header:void 0,xml:S}}(n=e.Body[d.$name])||(n=e.Body[d.$name.replace(/(?:Out(?:put)?|Response)$/,"")]);n||["Response","Out","Output"].forEach((function(t){if(e.Body.hasOwnProperty(a+t))return n=e.Body[a+t]}));return{err:null,result:n,responseBody:t,header:e.Header,xml:S}}(s,e,t)}(e.body,e)})))})))},me.prototype.call=function(e,t,s,n){return this[e]?this[e].call(this,t,s,n):u.throwError("Method "+e+" not found")};var ye={},ve=function(e,t){return d(void 0,void 0,void 0,(function(){return f(this,(function(s){return ye[e]?[2,ye[e]]:[2,oe(e,t).then((function(t){return ye[e]=t,t}))]}))}))};function ge(e,t){return d(this,void 0,void 0,(function(){return f(this,(function(s){return!0===t.disableCache?[2,oe(e,t)]:[2,ve(e,t)]}))}))}var xe=function(){function e(e){this.http=e}return e.prototype.createClient=function(e,t,s){return void 0===t&&(t={}),t.httpClient=this.http,function(e,t,s){return d(this,void 0,void 0,(function(){var n;return f(this,(function(i){switch(i.label){case 0:return void 0===t&&(t={}),s=t.endpoint||s,[4,ge(e,t)];case 1:return n=i.sent(),[2,new me(n,s,t)]}}))}))}(e,t,s)},e.ɵfac=function(s){return new(s||e)(t["ɵɵinject"](h.HttpClient))},e.ɵprov=t["ɵɵdefineInjectable"]({token:e,factory:e.ɵfac,providedIn:"root"}),e}(),be=function(){function e(){}return e.ɵmod=t["ɵɵdefineNgModule"]({type:e}),e.ɵinj=t["ɵɵdefineInjector"]({factory:function(t){return new(t||e)},imports:[[h.HttpClientModule]]}),e}();("undefined"==typeof ngJitMode||ngJitMode)&&t["ɵɵsetNgModuleScope"](be,{imports:[h.HttpClientModule]}),e.NgxSoapModule=be,e.NgxSoapService=xe,e.security=le,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-soap.umd.min.js.map